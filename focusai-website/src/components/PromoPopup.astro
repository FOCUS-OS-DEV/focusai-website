---
/**
 * PromoPopup - Rotating promotional popup (centered modal)
 * Shows one elegant popup per visit, cycling through messages.
 * Uses sessionStorage (once per visit) + localStorage (rotation index).
 */
---

<!-- Backdrop overlay -->
<div id="promo-overlay" class="promo-overlay" aria-hidden="true">
  <!-- Modal card -->
  <div id="promo-popup" class="promo-popup" role="dialog" aria-modal="true">
    <!-- Close button -->
    <button id="promo-close" class="promo-close" aria-label="סגור">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M2 2l12 12M2 14L14 2" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
    </button>

    <!-- Image area -->
    <div class="promo-image-wrap">
      <img id="promo-image" class="promo-image" src="" alt="" loading="eager" />
      <div class="promo-image-overlay"></div>
      <span id="promo-badge" class="promo-badge"></span>
    </div>

    <!-- Content -->
    <div class="promo-content">
      <h3 id="promo-title" class="promo-title"></h3>
      <p id="promo-desc" class="promo-desc"></p>

      <a id="promo-cta" class="promo-cta" href="/">
        <span id="promo-cta-text"></span>
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M12 8H4M7 4L3 8l4 4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </a>

      <button id="promo-dismiss" class="promo-dismiss">לא עכשיו, תודה</button>
    </div>

    <!-- Progress bar -->
    <div class="promo-progress">
      <div class="promo-progress-bar" id="promo-progress-bar"></div>
    </div>
  </div>
</div>

<style>
  /* ===== OVERLAY ===== */
  .promo-overlay {
    position: fixed;
    inset: 0;
    z-index: 55;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.35s ease;
    padding: 20px;
  }

  .promo-overlay.is-visible {
    opacity: 1;
    pointer-events: auto;
  }

  .promo-overlay.is-hiding {
    opacity: 0;
    pointer-events: none;
    transition-duration: 0.25s;
  }

  /* ===== MODAL CARD ===== */
  .promo-popup {
    position: relative;
    width: 100%;
    max-width: 480px;
    background: #12121a;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 24px;
    overflow: hidden;
    box-shadow:
      0 24px 80px rgba(0, 0, 0, 0.6),
      0 0 0 1px rgba(168, 85, 247, 0.08),
      0 0 60px rgba(168, 85, 247, 0.06);
    transform: scale(0.92) translateY(20px);
    transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .promo-overlay.is-visible .promo-popup {
    transform: scale(1) translateY(0);
  }

  .promo-overlay.is-hiding .promo-popup {
    transform: scale(0.95) translateY(10px);
    transition-duration: 0.25s;
  }

  /* ===== CLOSE BUTTON ===== */
  .promo-close {
    position: absolute;
    top: 12px;
    left: 12px;
    width: 34px;
    height: 34px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    color: rgba(255, 255, 255, 0.6);
    cursor: pointer;
    transition: all 0.2s;
    z-index: 3;
  }
  .promo-close:hover {
    background: rgba(0, 0, 0, 0.7);
    color: rgba(255, 255, 255, 0.9);
  }

  /* ===== IMAGE AREA ===== */
  .promo-image-wrap {
    position: relative;
    width: 100%;
    height: 260px;
    overflow: hidden;
  }

  .promo-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .promo-image-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      transparent 40%,
      rgba(18, 18, 26, 0.6) 75%,
      #12121a 100%
    );
    pointer-events: none;
  }

  .promo-badge {
    position: absolute;
    bottom: 14px;
    right: 16px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 5px 12px;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: #a855f7;
  }
  .promo-badge::before {
    content: '';
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: currentColor;
    animation: promo-pulse 2s ease-in-out infinite;
  }

  @keyframes promo-pulse {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 1; }
  }

  /* ===== CONTENT ===== */
  .promo-content {
    padding: 4px 24px 20px;
    text-align: center;
  }

  .promo-title {
    font-size: 1.3rem;
    font-weight: 800;
    color: #f5f5fa;
    line-height: 1.4;
    margin-bottom: 8px;
  }

  .promo-desc {
    font-size: 0.92rem;
    color: #9090a8;
    line-height: 1.7;
    margin-bottom: 20px;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }

  /* ===== CTA BUTTON ===== */
  .promo-cta {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 14px 24px;
    background: linear-gradient(135deg, #a855f7, #7c3aed);
    border: none;
    border-radius: 14px;
    color: #fff;
    font-size: 1rem;
    font-weight: 700;
    text-decoration: none;
    transition: all 0.3s;
    box-shadow: 0 4px 20px rgba(168, 85, 247, 0.3);
  }
  .promo-cta:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(168, 85, 247, 0.4);
    background: linear-gradient(135deg, #b86ef7, #8b5cf6);
  }

  /* CTA color variants */
  .promo-cta.cta-green {
    background: linear-gradient(135deg, #25D366, #128C7E);
    box-shadow: 0 4px 20px rgba(37, 211, 102, 0.3);
  }
  .promo-cta.cta-green:hover {
    box-shadow: 0 8px 30px rgba(37, 211, 102, 0.4);
    background: linear-gradient(135deg, #2de670, #159e6e);
  }

  .promo-cta.cta-amber {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    box-shadow: 0 4px 20px rgba(245, 158, 11, 0.3);
  }
  .promo-cta.cta-amber:hover {
    box-shadow: 0 8px 30px rgba(245, 158, 11, 0.4);
    background: linear-gradient(135deg, #fbbf24, #e6a20c);
  }

  .promo-cta.cta-blue {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
  }
  .promo-cta.cta-blue:hover {
    box-shadow: 0 8px 30px rgba(59, 130, 246, 0.4);
    background: linear-gradient(135deg, #60a5fa, #3b82f6);
  }

  /* ===== DISMISS LINK ===== */
  .promo-dismiss {
    display: block;
    margin: 12px auto 0;
    padding: 4px;
    background: none;
    border: none;
    color: #606078;
    font-size: 0.78rem;
    cursor: pointer;
    transition: color 0.2s;
  }
  .promo-dismiss:hover {
    color: #9090a8;
  }

  /* ===== PROGRESS BAR ===== */
  .promo-progress {
    height: 3px;
    background: rgba(255, 255, 255, 0.04);
  }

  .promo-progress-bar {
    height: 100%;
    width: 100%;
    background: linear-gradient(90deg, #a855f7, #c084fc);
    transform-origin: right;
    transition: transform linear;
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 640px) {
    .promo-overlay {
      padding: 16px;
      align-items: center;
    }
    .promo-popup {
      max-width: 100%;
      border-radius: 20px;
    }
    .promo-image-wrap {
      height: 200px;
    }
    .promo-title {
      font-size: 1.15rem;
    }
    .promo-desc {
      font-size: 0.85rem;
    }
    .promo-content {
      padding: 4px 18px 16px;
    }
    .promo-cta {
      padding: 12px 20px;
      font-size: 0.95rem;
    }
  }

  @media (max-width: 380px) {
    .promo-overlay {
      padding: 10px;
    }
    .promo-image-wrap {
      height: 170px;
    }
    .promo-title {
      font-size: 1.05rem;
    }
    .promo-desc {
      font-size: 0.82rem;
      margin-bottom: 14px;
    }
    .promo-content {
      padding: 2px 14px 14px;
    }
  }
</style>

<script is:inline>
(function() {
  var SESSION_KEY = 'focus_promo_shown';
  var ROTATION_KEY = 'focus_promo_index';
  var SHOW_DELAY = 5000;
  var AUTO_DISMISS = 12000;

  // Excluded pages
  var excluded = ['/content-automation-watch', '/content-automation-course', '/webinar-n8n-agent', '/webinar-n8n-thank-you'];
  var path = window.location.pathname.replace(/\/$/, '');
  for (var i = 0; i < excluded.length; i++) {
    if (path === excluded[i]) return;
  }

  // Once per visit
  if (sessionStorage.getItem(SESSION_KEY)) return;

  var CLD = 'https://res.cloudinary.com/dfudxxzlj/image/upload/';

  // Messages pool
  var messages = [
    {
      badge: 'ACADEMY',
      title: '\u05de\u05e7\u05d5\u05de\u05d5\u05ea \u05d0\u05d7\u05e8\u05d5\u05e0\u05d9\u05dd \u05dc\u05de\u05d7\u05d6\u05d5\u05e8 \u05d4\u05e7\u05e8\u05d5\u05d1',
      desc: 'Bot-Camp \u2013 \u05ea\u05d5\u05db\u05e0\u05d9\u05ea \u05d4\u05db\u05e9\u05e8\u05d4 \u05de\u05e7\u05e6\u05d5\u05e2\u05d9\u05ea \u05dc\u05d1\u05e0\u05d9\u05d9\u05ea \u05d0\u05d5\u05d8\u05d5\u05de\u05e6\u05d9\u05d5\u05ea \u05d5\u05e1\u05d5\u05db\u05e0\u05d9 AI, \u05d1\u05dc\u05d9\u05d5\u05d5\u05d9 \u05d0\u05e7\u05d3\u05de\u05d9 \u05e9\u05dc \u05d0\u05d5\u05e0\u05d9\u05d1\u05e8\u05e1\u05d9\u05d8\u05ea \u05d7\u05d9\u05e4\u05d4.',
      cta: '\u05dc\u05e4\u05e8\u05d8\u05d9\u05dd \u05e0\u05d5\u05e1\u05e4\u05d9\u05dd',
      href: '/academy/',
      image: CLD + 'q_auto,f_auto,w_520,h_300,c_fill/v1770470074/111_kyis5b.jpg',
      ctaClass: ''
    },
    {
      badge: 'FREE',
      title: '\u05d4\u05d3\u05e8\u05db\u05d4 \u05d7\u05d9\u05e0\u05de\u05d9\u05ea: \u05d0\u05d5\u05d8\u05d5\u05de\u05e6\u05d9\u05d9\u05ea \u05ea\u05d5\u05db\u05df \u05e2\u05dd AI',
      desc: '\u05e6\u05e4\u05d5 \u05d1\u05d4\u05d3\u05e8\u05db\u05d4 \u05de\u05e2\u05e9\u05d9\u05ea \u05d5\u05dc\u05de\u05d3\u05d5 \u05d0\u05d9\u05da \u05dc\u05d1\u05e0\u05d5\u05ea \u05d0\u05d5\u05d8\u05d5\u05de\u05e6\u05d9\u05d4 \u05e9\u05dc\u05de\u05d4 \u05dc\u05d9\u05e6\u05d9\u05e8\u05ea \u05ea\u05d5\u05db\u05df \u2013 \u05de\u05d0\u05e4\u05e1 \u05d5\u05e2\u05d3 \u05e4\u05d5\u05e1\u05d8 \u05de\u05d5\u05db\u05df.',
      cta: '\u05dc\u05e6\u05e4\u05d9\u05d9\u05d4 \u05d1\u05d7\u05d9\u05e0\u05dd',
      href: '/content-automation-course/',
      image: CLD + 'q_auto,f_auto,w_520,h_300,c_fill/v1771764387/66f2db89-c663-40aa-8932-7cde61c5f22b_pskwxj.png',
      ctaClass: ''
    },
    {
      badge: 'COMMUNITY',
      title: '\u05d4\u05e6\u05d8\u05e8\u05e4\u05d5 \u05dc\u05e7\u05d4\u05d9\u05dc\u05ea AI \u05e9\u05dc\u05e0\u05d5',
      desc: '\u05d8\u05d9\u05e4\u05d9\u05dd, \u05de\u05d3\u05e8\u05d9\u05db\u05d9\u05dd, \u05e2\u05d3\u05db\u05d5\u05e0\u05d9\u05dd \u05d5\u05db\u05dc\u05d9\u05dd \u05d7\u05d3\u05e9\u05d9\u05dd \u2013 \u05d9\u05e9\u05d9\u05e8\u05d5\u05ea \u05d1\u05e7\u05d4\u05d9\u05dc\u05ea \u05d4-WhatsApp \u05e9\u05dc\u05e0\u05d5.',
      cta: '\u05d4\u05e6\u05d8\u05e8\u05e4\u05d5 \u05dc\u05e7\u05d4\u05d9\u05dc\u05d4',
      href: 'https://did.li/Focus-community',
      image: CLD + 'q_auto,f_auto,w_520,h_300,c_fill,g_center/v1770388356/0e214975-5aab-422d-a865-afb04e3179b7_pjtmso.png',
      ctaClass: 'cta-green',
      external: true
    },
    {
      badge: 'AI NEWS',
      title: 'AI \u05dc\u05d0 \u05de\u05d7\u05db\u05d4 \u05dc\u05d0\u05e3 \u05d0\u05d7\u05d3',
      desc: '\u05db\u05dc \u05e9\u05d1\u05d5\u05e2 \u05e7\u05d5\u05e8\u05d4 \u05de\u05e9\u05d4\u05d5 \u05e9\u05de\u05e9\u05e0\u05d4 \u05d0\u05ea \u05d4\u05db\u05dc\u05dc\u05d9\u05dd. \u05d0\u05e0\u05d7\u05e0\u05d5 \u05de\u05e1\u05db\u05de\u05d9\u05dd \u05d0\u05ea \u05de\u05d4 \u05e9\u05d7\u05e9\u05d5\u05d1 \u05d1\u05e2\u05d1\u05e8\u05d9\u05ea \u05e4\u05e9\u05d5\u05d8\u05d4.',
      cta: '\u05dc\u05d7\u05d3\u05e9\u05d5\u05ea AI',
      href: '/ai-news/',
      image: CLD + 'q_auto,f_auto,w_520,h_300,c_fill/v1770947684/f25e86b9-3f3c-400f-abf1-cb242a673cd4_p8fmzp.png',
      ctaClass: 'cta-amber'
    },
    {
      badge: 'FREE TOOL',
      title: 'Prompt Master \u2013 \u05e1\u05d5\u05db\u05df AI \u05d7\u05d9\u05e0\u05de\u05d9',
      desc: '\u05e1\u05d5\u05db\u05df AI \u05e9\u05d9\u05e2\u05d6\u05d5\u05e8 \u05dc\u05db\u05dd \u05dc\u05db\u05ea\u05d5\u05d1 \u05e4\u05e8\u05d5\u05de\u05e4\u05d8\u05d9\u05dd \u05de\u05d3\u05d5\u05d9\u05e7\u05d9\u05dd \u05dc\u05db\u05dc \u05de\u05d8\u05e8\u05d4. \u05d7\u05d9\u05e0\u05dd \u05dc\u05d2\u05de\u05e8\u05d9.',
      cta: '\u05dc\u05e0\u05e1\u05d5\u05ea \u05d1\u05d7\u05d9\u05e0\u05dd',
      href: 'https://chatgpt.com/g/g-68c7d685d6e081918de17b06b52e8a5e-focus-ai-prompt-master-v3',
      image: CLD + 'q_auto,f_auto,w_520,h_300,c_fill/v1770840878/f0701d6a-0e1e-4a52-9c61-56bda2e67012_rhtdvf.png',
      ctaClass: '',
      external: true
    },
    {
      badge: 'ENTERPRISE',
      title: '\u05d4\u05db\u05e9\u05e8\u05ea \u05e2\u05d5\u05d1\u05d3\u05d9\u05dd \u05d1-AI',
      desc: 'AI Ready \u2013 \u05ea\u05d5\u05db\u05e0\u05d9\u05ea \u05d4\u05db\u05e9\u05e8\u05d4 \u05d0\u05e8\u05d2\u05d5\u05e0\u05d9\u05ea \u05e9\u05de\u05db\u05d9\u05e0\u05d4 \u05d0\u05ea \u05d4\u05e6\u05d5\u05d5\u05ea \u05e9\u05dc\u05db\u05dd \u05dc\u05e2\u05d5\u05dc\u05dd \u05d4-AI.',
      cta: '\u05dc\u05e4\u05e8\u05d8\u05d9\u05dd',
      href: '/academy/ai-ready/',
      image: CLD + 'q_auto,f_auto,w_520,h_300,c_fill/v1770386851/%D7%AA%D7%9E%D7%95%D7%A0%D7%94-%D7%9B%D7%99%D7%AA%D7%94-e1762357672410-1024x438_fpwarm.png',
      ctaClass: 'cta-blue'
    }
  ];

  // Rotation
  var idx = parseInt(localStorage.getItem(ROTATION_KEY) || '0', 10);
  if (isNaN(idx) || idx < 0) idx = 0;
  var msg = messages[idx % messages.length];
  localStorage.setItem(ROTATION_KEY, String((idx + 1) % messages.length));

  document.addEventListener('DOMContentLoaded', function() {
    var overlay = document.getElementById('promo-overlay');
    if (!overlay) return;

    // Populate
    document.getElementById('promo-image').src = msg.image;
    document.getElementById('promo-image').alt = msg.title;
    document.getElementById('promo-badge').textContent = msg.badge;
    document.getElementById('promo-title').textContent = msg.title;
    document.getElementById('promo-desc').textContent = msg.desc;
    document.getElementById('promo-cta-text').textContent = msg.cta;

    var ctaEl = document.getElementById('promo-cta');
    ctaEl.href = msg.href;
    if (msg.external) {
      ctaEl.target = '_blank';
      ctaEl.rel = 'noopener noreferrer';
    }
    if (msg.ctaClass) ctaEl.classList.add(msg.ctaClass);

    var progressBar = document.getElementById('promo-progress-bar');
    var dismissTimer = null;

    function show() {
      sessionStorage.setItem(SESSION_KEY, '1');
      overlay.classList.add('is-visible');
      overlay.setAttribute('aria-hidden', 'false');

      // Progress bar
      progressBar.style.transition = 'transform ' + AUTO_DISMISS + 'ms linear';
      requestAnimationFrame(function() {
        progressBar.style.transform = 'scaleX(0)';
      });

      dismissTimer = setTimeout(hide, AUTO_DISMISS);
    }

    function hide() {
      if (dismissTimer) clearTimeout(dismissTimer);
      overlay.classList.add('is-hiding');
      overlay.classList.remove('is-visible');
      overlay.setAttribute('aria-hidden', 'true');
      setTimeout(function() { overlay.style.display = 'none'; }, 300);
    }

    // Close handlers
    document.getElementById('promo-close').addEventListener('click', hide);
    document.getElementById('promo-dismiss').addEventListener('click', hide);

    // Click on overlay (outside card) to close
    overlay.addEventListener('click', function(e) {
      if (e.target === overlay) hide();
    });

    // Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && overlay.classList.contains('is-visible')) hide();
    });

    // Show after delay
    setTimeout(show, SHOW_DELAY);
  });
})();
</script>
