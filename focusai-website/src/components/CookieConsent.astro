---
/**
 * Cookie Consent Banner
 * - Blocks analytics until consent is given
 * - Stores consent in localStorage
 * - Compliant with Israeli law and GDPR
 */
---

<div
  id="cookie-banner"
  class="fixed bottom-0 left-0 right-0 z-50 p-4 bg-[#0d0d1a] backdrop-blur-lg border-t border-[#a855f7]/30 shadow-[0_-4px_30px_rgba(0,0,0,0.5)] transform translate-y-full transition-transform duration-500"
  role="dialog"
  aria-labelledby="cookie-title"
  aria-describedby="cookie-description"
>
  <div class="max-w-7xl mx-auto flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
    <div class="flex-1">
      <h3 id="cookie-title" class="text-white font-semibold text-lg mb-1">
          砖转砖 注转
      </h3>
      <p id="cookie-description" class="text-white/60 text-sm">
        转专 砖转砖 注转 爪专 砖驻专 转 砖转砖 转 转注专.
        <a href="/privacy" class="text-[#c084fc] hover:underline">注 住祝</a>
      </p>
    </div>
    <div class="flex items-center gap-3">
      <button
        id="cookie-accept-all"
        class="px-6 py-2 rounded-xl bg-gradient-to-r from-[#a855f7] to-[#ec4899] text-white font-medium hover:opacity-90 transition-opacity"
      >
        砖专 
      </button>
      <button
        id="cookie-accept-essential"
        class="px-6 py-2 rounded-xl bg-white/10 border border-white/20 text-white font-medium hover:bg-white/20 transition-colors"
      >
        注转 专转 
      </button>
      <button
        id="cookie-settings"
        class="p-2 rounded-xl text-white/50 hover:text-white hover:bg-white/10 transition-colors"
        aria-label="专转 注转"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- Cookie Settings Modal -->
<div
  id="cookie-modal"
  class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm"
  role="dialog"
  aria-modal="true"
  aria-labelledby="modal-title"
>
  <div class="bg-[#0d0d1a] rounded-2xl p-6 max-w-lg mx-4 max-h-[90vh] overflow-y-auto border border-[#a855f7]/30 shadow-[0_8px_40px_rgba(0,0,0,0.6)]">
    <div class="flex items-center justify-between mb-6">
      <h3 id="modal-title" class="text-xl font-bold text-white">专转 注转</h3>
      <button id="modal-close" class="text-white/50 hover:text-white" aria-label="住专">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <div class="space-y-4">
      <!-- Essential Cookies -->
      <div class="p-4 rounded-xl bg-white/5 border border-white/10">
        <div class="flex items-center justify-between mb-2">
          <h4 class="font-semibold text-white">注转 专转</h4>
          <span class="text-xs px-2 py-1 rounded-full bg-green-500/20 text-green-400">转 驻注</span>
        </div>
        <p class="text-sm text-white/60">
          注转  专砖转 转驻注 转专  转  转.
        </p>
      </div>

      <!-- Analytics Cookies -->
      <div class="p-4 rounded-xl bg-white/5 border border-white/10">
        <div class="flex items-center justify-between mb-2">
          <h4 class="font-semibold text-white">注转 拽住</h4>
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" id="analytics-toggle" class="sr-only peer" />
            <div class="w-11 h-6 bg-white/20 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#a855f7]"></div>
          </label>
        </div>
        <p class="text-sm text-white/60">
          注转  注专转   爪 砖转砖 转专 砖驻专 转.
        </p>
      </div>

      <!-- Marketing Cookies -->
      <div class="p-4 rounded-xl bg-white/5 border border-white/10">
        <div class="flex items-center justify-between mb-2">
          <h4 class="font-semibold text-white">注转 砖拽转</h4>
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" id="marketing-toggle" class="sr-only peer" />
            <div class="w-11 h-6 bg-white/20 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#a855f7]"></div>
          </label>
        </div>
        <p class="text-sm text-white/60">
          注转  砖砖转 爪专 爪转 驻专住转 专转.
        </p>
      </div>
    </div>

    <div class="flex gap-3 mt-6">
      <button
        id="save-preferences"
        class="flex-1 px-6 py-3 rounded-xl bg-gradient-to-r from-[#a855f7] to-[#ec4899] text-white font-medium hover:opacity-90 transition-opacity"
      >
        砖专 注驻转
      </button>
      <button
        id="accept-all-modal"
        class="flex-1 px-6 py-3 rounded-xl bg-white/10 border border-white/20 text-white font-medium hover:bg-white/20 transition-colors"
      >
        砖专 
      </button>
    </div>
  </div>
</div>

<script>
  // Cookie Consent Script
  const CONSENT_KEY = 'focus_ai_cookie_consent';

  interface CookieConsent {
    essential: boolean;
    analytics: boolean;
    marketing: boolean;
    timestamp: number;
  }

  // Check if consent already given
  function getConsent(): CookieConsent | null {
    const consent = localStorage.getItem(CONSENT_KEY);
    if (consent) {
      return JSON.parse(consent);
    }
    return null;
  }

  // Save consent
  function saveConsent(consent: CookieConsent) {
    localStorage.setItem(CONSENT_KEY, JSON.stringify(consent));
    applyConsent(consent);
    hideBanner();
  }

  // Apply consent settings
  function applyConsent(consent: CookieConsent) {
    // Enable/disable analytics based on consent
    if (consent.analytics) {
      // Load Google Analytics or other analytics here
      // Example: window.gtag && window.gtag('consent', 'update', { 'analytics_storage': 'granted' });
      document.dispatchEvent(new CustomEvent('analytics-consent-granted'));
    }

    if (consent.marketing) {
      // Load marketing pixels here
      // Example: Load Facebook Pixel, etc.
      document.dispatchEvent(new CustomEvent('marketing-consent-granted'));
    }
  }

  // Show banner
  function showBanner() {
    const banner = document.getElementById('cookie-banner');
    if (banner) {
      banner.classList.remove('translate-y-full');
    }
    // Move WhatsApp float up so it doesn't overlap
    const waFloat = document.getElementById('whatsapp-float');
    if (waFloat) {
      waFloat.style.transition = 'bottom 0.5s ease';
      waFloat.style.bottom = '5.5rem';
    }
  }

  // Hide banner
  function hideBanner() {
    const banner = document.getElementById('cookie-banner');
    if (banner) {
      banner.classList.add('translate-y-full');
    }
    // Move WhatsApp float back down
    const waFloat = document.getElementById('whatsapp-float');
    if (waFloat) {
      waFloat.style.bottom = '';
    }
  }

  // Show modal
  function showModal() {
    const modal = document.getElementById('cookie-modal');
    if (modal) {
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }
  }

  // Hide modal
  function hideModal() {
    const modal = document.getElementById('cookie-modal');
    if (modal) {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    const consent = getConsent();

    if (!consent) {
      // No consent yet, show banner after 1 second
      setTimeout(showBanner, 1000);
    } else {
      // Apply existing consent
      applyConsent(consent);
    }

    // Accept all button
    document.getElementById('cookie-accept-all')?.addEventListener('click', () => {
      saveConsent({
        essential: true,
        analytics: true,
        marketing: true,
        timestamp: Date.now()
      });
    });

    // Accept essential only button
    document.getElementById('cookie-accept-essential')?.addEventListener('click', () => {
      saveConsent({
        essential: true,
        analytics: false,
        marketing: false,
        timestamp: Date.now()
      });
    });

    // Settings button
    document.getElementById('cookie-settings')?.addEventListener('click', () => {
      hideBanner();
      showModal();

      // Set toggle states based on current consent
      const currentConsent = getConsent();
      const analyticsToggle = document.getElementById('analytics-toggle') as HTMLInputElement;
      const marketingToggle = document.getElementById('marketing-toggle') as HTMLInputElement;

      if (analyticsToggle) {
        analyticsToggle.checked = currentConsent?.analytics ?? false;
      }
      if (marketingToggle) {
        marketingToggle.checked = currentConsent?.marketing ?? false;
      }
    });

    // Modal close button
    document.getElementById('modal-close')?.addEventListener('click', hideModal);

    // Save preferences button
    document.getElementById('save-preferences')?.addEventListener('click', () => {
      const analyticsToggle = document.getElementById('analytics-toggle') as HTMLInputElement;
      const marketingToggle = document.getElementById('marketing-toggle') as HTMLInputElement;

      saveConsent({
        essential: true,
        analytics: analyticsToggle?.checked ?? false,
        marketing: marketingToggle?.checked ?? false,
        timestamp: Date.now()
      });

      hideModal();
    });

    // Accept all in modal
    document.getElementById('accept-all-modal')?.addEventListener('click', () => {
      saveConsent({
        essential: true,
        analytics: true,
        marketing: true,
        timestamp: Date.now()
      });

      hideModal();
    });

    // Close modal on backdrop click
    document.getElementById('cookie-modal')?.addEventListener('click', (e) => {
      if (e.target === e.currentTarget) {
        hideModal();
      }
    });
  });
</script>
