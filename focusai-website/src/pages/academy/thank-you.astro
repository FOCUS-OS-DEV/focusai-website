---
/**
 * Thank You Page - Bot-Camp Form Submission
 * Shows Zohar's testimonial video + more videos + advisor message
 */
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

const videoTestimonials = [
  {
    name: "זוהר יעקב",
    role: "סטודנט הכשרת Focus AI",
    video: "https://res.cloudinary.com/dfudxxzlj/video/upload/q_auto/v1770711777/%D7%A4%D7%95%D7%A7%D7%95%D7%A1_%D7%96%D7%95%D7%94%D7%A8_%D7%99%D7%A2%D7%A7%D7%91_s4jds5_1_xhrejb.mp4",
    poster: "https://res.cloudinary.com/dfudxxzlj/video/upload/so_0.1,w_400,h_710,c_fill,q_auto,f_jpg/v1770711777/%D7%A4%D7%95%D7%A7%D7%95%D7%A1_%D7%96%D7%95%D7%94%D7%A8_%D7%99%D7%A2%D7%A7%D7%91_s4jds5_1_xhrejb.jpg",
  },
  {
    name: "חגית",
    role: "מנהלת המרכז לפיתוח קריירה, אוניברסיטת חיפה",
    video: "https://res.cloudinary.com/dfudxxzlj/video/upload/q_auto/v1770711629/IMG_0753_iah7ft_1_roxnqc.mp4",
    poster: "https://res.cloudinary.com/dfudxxzlj/video/upload/so_0.1,w_400,h_710,c_fill,q_auto,f_jpg/v1770711629/IMG_0753_iah7ft_1_roxnqc.jpg",
  },
  {
    name: "מטר",
    role: "בוגרת הכשרת Focus AI",
    video: "https://res.cloudinary.com/dfudxxzlj/video/upload/q_auto/v1770711703/%D7%9E%D7%98%D7%A8_%D7%A4%D7%95%D7%A7%D7%95%D7%A1_AI_jg7esj_qtan3r.mp4",
    poster: "https://res.cloudinary.com/dfudxxzlj/video/upload/so_0.1,w_400,h_710,c_fill,q_auto,f_jpg/v1770711703/%D7%9E%D7%98%D7%A8_%D7%A4%D7%95%D7%A7%D7%95%D7%A1_AI_jg7esj_qtan3r.jpg",
  },
  {
    name: "בני",
    role: "בוגר הכשרת Focus AI",
    video: "https://res.cloudinary.com/dfudxxzlj/video/upload/q_auto/v1770711663/IMG_3467_pg6tos_1_pkb8qv.mp4",
    poster: "https://res.cloudinary.com/dfudxxzlj/video/upload/so_0.1,w_400,h_710,c_fill,q_auto,f_jpg/v1770711663/IMG_3467_pg6tos_1_pkb8qv.jpg",
  },
  {
    name: "שניר",
    role: "בוגר הכשרת Focus AI",
    video: "https://res.cloudinary.com/dfudxxzlj/video/upload/q_auto/v1770711683/%D7%A9%D7%A0%D7%99%D7%A8_%D7%A4%D7%95%D7%A7%D7%95%D7%A1_AI_mxbzrj_1_cwq90t.mp4",
    poster: "https://res.cloudinary.com/dfudxxzlj/video/upload/so_0.1,w_400,h_710,c_fill,q_auto,f_jpg/v1770711683/%D7%A9%D7%A0%D7%99%D7%A8_%D7%A4%D7%95%D7%A7%D7%95%D7%A1_AI_mxbzrj_1_cwq90t.jpg",
  },
  {
    name: "ארטיום",
    role: "בוגר הכשרת Focus AI",
    video: "https://res.cloudinary.com/dfudxxzlj/video/upload/q_auto/v1770711686/%D7%90%D7%A8%D7%98%D7%99%D7%95%D7%9D_%D7%A4%D7%95%D7%A7%D7%95%D7%A1_AI_pzkt2y_1_zaaisz.mp4",
    poster: "https://res.cloudinary.com/dfudxxzlj/video/upload/so_0.1,w_400,h_710,c_fill,q_auto,f_jpg/v1770711686/%D7%90%D7%A8%D7%98%D7%99%D7%95%D7%9D_%D7%A4%D7%95%D7%A7%D7%95%D7%A1_AI_pzkt2y_1_zaaisz.jpg",
  },
];

const moreVideos = videoTestimonials.slice(1);
---

<BaseLayout title="תודה! | Focus AI" description="הפרטים נקלטו בהצלחה">
  <Header slot="header" />

  <!-- Meta Pixel Code - PageView + Lead -->
  <script is:inline>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '801192442681278');
    fbq('track', 'PageView');
    fbq('track', 'Lead');
  </script>
  <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=801192442681278&ev=PageView&noscript=1" /></noscript>

  <!-- Hero Message -->
  <section class="pt-32 pb-8 bg-[#0a0a0f] text-center">
    <div class="container px-4">
      <div class="inline-flex items-center gap-3 px-5 py-2.5 bg-[#12121a] border border-green-500/30 mb-6">
        <span class="w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse"></span>
        <span class="font-mono text-sm font-semibold text-green-400 uppercase tracking-[0.15em]">RECEIVED</span>
      </div>
      <h1 class="text-2xl sm:text-3xl md:text-5xl lg:text-6xl font-black text-white mb-4">
        תודה! <span class="text-transparent bg-clip-text bg-gradient-to-r from-[#a855f7] to-[#c084fc]">הפרטים נקלטו</span>
      </h1>
      <p class="text-xl md:text-2xl text-[#b0b0c0] max-w-2xl mx-auto">
        יועץ לימודים כבר יחזור אליך בהקדם
      </p>
    </div>
  </section>

  <!-- Zohar's Featured Video -->
  <section class="py-10 bg-[#0a0a0f]">
    <div class="container px-4">
      <div class="text-center mb-8">
        <h2 class="text-2xl md:text-3xl font-bold text-white">
          בינתיים, שמעו מה <span class="text-[#a855f7]">זוהר</span> אומר על ההכשרה
        </h2>
      </div>

      <div class="max-w-sm mx-auto">
        <div class="relative rounded-2xl overflow-hidden border-2 border-[#a855f7]/40 shadow-[0_0_60px_rgba(168,85,247,0.3)]">
          <div class="aspect-[9/16]">
            <video
              id="featured-video"
              class="w-full h-full object-cover"
              controls
              playsinline
              poster={videoTestimonials[0].poster}
              src={videoTestimonials[0].video}
            ><track kind="captions" default /></video>
          </div>
          <div class="absolute bottom-3 left-3 right-3 bg-[#12121a]/85 backdrop-blur-md rounded-xl p-3 border border-[#a855f7]/20">
            <p class="text-white font-bold text-center">{videoTestimonials[0].name}</p>
            <p class="text-[#a855f7] text-xs text-center mt-1">{videoTestimonials[0].role}</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- More Testimonials -->
  <section class="py-10 bg-[#0a0a0f]">
    <div class="container px-4">
      <div class="text-center mb-8">
        <h2 class="text-2xl md:text-3xl font-bold text-white">
          עוד <span class="text-[#a855f7]">בוגרים מספרים</span>
        </h2>
      </div>

      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4 max-w-4xl mx-auto">
        {moreVideos.map((t) => (
          <button
            class="more-video-card group relative rounded-xl overflow-hidden border border-[#2a2a3a] hover:border-[#a855f7]/50 transition-all cursor-pointer bg-transparent p-0"
            data-video={t.video}
            data-name={t.name}
            data-role={t.role}
          >
            <div class="aspect-[9/16]">
              <img
                src={t.poster}
                alt={t.name}
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                loading="lazy"
              />
            </div>
            <!-- Play icon -->
            <div class="absolute inset-0 flex items-center justify-center bg-black/30 group-hover:bg-black/10 transition-colors">
              <div class="w-10 h-10 bg-[#a855f7]/90 rounded-full flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                <svg class="w-5 h-5 fill-white mr-[-2px]" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
              </div>
            </div>
            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-2">
              <p class="text-white text-xs font-semibold text-center">{t.name}</p>
            </div>
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- Video Lightbox -->
  <div id="videoLightbox" class="fixed inset-0 z-[9999] bg-black/95 backdrop-blur-lg hidden items-center justify-center p-4">
    <button id="lightbox-close" class="absolute top-4 right-4 w-12 h-12 bg-white/10 backdrop-blur-xl border border-white/20 rounded-full flex items-center justify-center hover:scale-110 hover:bg-white/20 transition-all z-10">
      <svg class="w-6 h-6 stroke-white" viewBox="0 0 24 24" fill="none" stroke-width="2.5"><path d="M18 6L6 18M6 6l12 12"/></svg>
    </button>
    <div class="max-w-sm w-full">
      <div class="rounded-2xl overflow-hidden border-2 border-[#a855f7]/40 shadow-[0_0_80px_rgba(168,85,247,0.4)]">
        <div class="aspect-[9/16]">
          <video id="lightbox-video" class="w-full h-full object-cover" controls playsinline><track kind="captions" default /></video>
        </div>
      </div>
      <div class="text-center mt-4">
        <p id="lightbox-name" class="text-white text-xl font-bold"></p>
        <p id="lightbox-role" class="text-[#a855f7] text-sm mt-1"></p>
      </div>
    </div>
  </div>

  <!-- Back to Home -->
  <section class="py-12 bg-[#0a0a0f]">
    <div class="container px-4 text-center">
      <a
        href="/"
        class="inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-[#a855f7] to-[#c084fc] text-white font-bold text-lg rounded-full hover:shadow-lg hover:shadow-[#a855f7]/30 transition-all hover:scale-[1.02]"
      >
        <span>חזרה לדף הבית</span>
        <svg class="w-5 h-5 rotate-180" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9 18 15 12 9 6"/></svg>
      </a>
    </div>
  </section>

  <Footer slot="footer" />
</BaseLayout>

<script>
  const isMobileVideo = window.innerWidth < 768;
  function mobileVideoUrl(url: string): string {
    if (!isMobileVideo) return url;
    return url.replace('/upload/q_auto/', '/upload/w_720,q_auto/');
  }

  // Auto-play featured video (with mobile 720p)
  const featured = document.getElementById('featured-video') as HTMLVideoElement;
  if (featured && isMobileVideo) {
    featured.src = mobileVideoUrl(featured.src);
  }
  if (featured) {
    featured.play().catch(() => {});
  }

  // Lightbox for more videos
  const lightbox = document.getElementById('videoLightbox');
  const lightboxVideo = document.getElementById('lightbox-video') as HTMLVideoElement;
  const lightboxName = document.getElementById('lightbox-name');
  const lightboxRole = document.getElementById('lightbox-role');
  const closeBtn = document.getElementById('lightbox-close');

  document.querySelectorAll('.more-video-card').forEach((card) => {
    card.addEventListener('click', () => {
      const video = card.getAttribute('data-video') || '';
      const name = card.getAttribute('data-name') || '';
      const role = card.getAttribute('data-role') || '';

      if (lightboxVideo) lightboxVideo.src = mobileVideoUrl(video);
      if (lightboxName) lightboxName.textContent = name;
      if (lightboxRole) lightboxRole.textContent = role;

      lightbox?.classList.remove('hidden');
      lightbox?.classList.add('flex');
      document.body.style.overflow = 'hidden';
      setTimeout(() => lightboxVideo?.play(), 150);
    });
  });

  function closeLightbox() {
    if (lightboxVideo) {
      lightboxVideo.pause();
      lightboxVideo.src = '';
    }
    lightbox?.classList.add('hidden');
    lightbox?.classList.remove('flex');
    document.body.style.overflow = '';
  }

  closeBtn?.addEventListener('click', closeLightbox);
  lightbox?.addEventListener('click', (e) => {
    if (e.target === lightbox) closeLightbox();
  });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeLightbox();
  });
</script>
