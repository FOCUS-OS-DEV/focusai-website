(function(){let d=0,s=0;const u=document.querySelectorAll(".carousel-slide"),r=u.length;let f=!1,I=0,v=!1,a=!1;const A={},q={},b=document.querySelector(".video-carousel-section");if(!b)return;const B=new IntersectionObserver(e=>{e.forEach(t=>{t.isIntersecting&&!v&&(v=!0,M(),setTimeout(()=>k(),800),B.unobserve(b))})},{rootMargin:"200px 0px"});B.observe(b);function M(){u.forEach(e=>{const t=e.getAttribute("data-pos");(t==="center"||t==="left"||t==="right")&&E(e)}),setTimeout(()=>{u.forEach(e=>E(e))},1500)}function E(e){const t=e.getAttribute("data-index");if(!t||A[t])return;const n=e.getAttribute("data-poster");if(!n)return;const o=e.querySelector(".poster-img");o&&(o.onload=()=>{o.classList.add("loaded"),e.classList.add("media-ready")},o.onerror=()=>{e.classList.add("media-ready")},o.src=n,A[t]=!0)}function k(){_(d,1).forEach(t=>R(t))}const U=window.innerWidth<768;function Y(e){return U?e.replace("/upload/q_auto/","/upload/w_720,q_auto/"):e}function R(e){if(q[e])return;const t=document.querySelector(`.carousel-slide[data-index="${e}"]`);if(!t)return;const n=t.getAttribute("data-video");if(!n)return;const o=t.querySelector("video");!o||o.src&&o.src!==""||(o.src=Y(n)+"#t=0.1",o.preload="metadata",o.onloadeddata=()=>{o.classList.add("video-loaded")},q[e]=!0)}function _(e,t){const n=[e];for(let o=1;o<=t;o++)n.push((e+o)%r),n.push((e-o+r)%r);return n}const w=document.getElementById("carouselDots");if(w)for(let e=0;e<r;e++){const t=document.createElement("button");t.className="carousel-dot"+(e===0?" active":""),t.setAttribute("data-dot",String(e)),t.setAttribute("aria-label","עבור לעדות "+(e+1)),t.onclick=()=>F(e),w.appendChild(t)}function D(e){return e===0?"center":e===1?"left":e===-1?"right":e===2?"far-left":e===-2?"far-right":"hidden"}function x(){u.forEach(t=>{let o=parseInt(t.getAttribute("data-index")||"0")-d;o>r/2&&(o-=r),o<-r/2&&(o+=r),t.setAttribute("data-pos",D(o))}),document.querySelectorAll(".carousel-dot").forEach((t,n)=>{t.classList.toggle("active",n===d)}),v&&(u.forEach(t=>{const n=t.getAttribute("data-pos");(n==="center"||n==="left"||n==="right")&&E(t)}),setTimeout(()=>k(),300))}function F(e){f||e===d||(f=!0,d=e,x(),setTimeout(()=>{f=!1},550))}function l(e){f||(f=!0,d=(d+e+r)%r,x(),setTimeout(()=>{f=!1},550))}function $(e){const t=e.getAttribute("data-pos");if(t==="center"){const n=parseInt(e.getAttribute("data-index")||"0");z(n)}else t==="right"?l(-1):t==="left"&&l(1)}function P(e){const t=document.querySelector(`.carousel-slide[data-index="${e}"]`);return t?{video:t.getAttribute("data-video")||"",name:t.querySelector(".name")?.textContent||"",role:t.querySelector(".role")?.textContent||""}:null}const T=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,L=document.getElementById("videoLightbox");L&&L.parentElement!==document.body&&document.body.appendChild(L);function W(){document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",window.lenis?.stop();const e=document.querySelector("main");e&&(e.style.display="none");const t=document.querySelector("header");t&&(t.style.display="none");const n=document.querySelector("footer");n&&(n.style.display="none");const o=document.getElementById("whatsapp-float");o&&(o.style.display="none");const i=document.getElementById("back-to-top");i&&(i.style.display="none")}function j(){document.body.style.overflow="",document.documentElement.style.overflow="",window.lenis?.start();const e=document.querySelector("main");e&&(e.style.display="");const t=document.querySelector("header");t&&(t.style.display="");const n=document.querySelector("footer");n&&(n.style.display="");const o=document.getElementById("whatsapp-float");o&&(o.style.display="");const i=document.getElementById("back-to-top");i&&(i.style.display="")}const h=document.getElementById("lightboxPlayOverlay");function p(){h?.classList.add("visible");const e=document.getElementById("lightboxVideo");e&&(e.controls=!1,e.style.pointerEvents="none")}function g(){h?.classList.remove("visible");const e=document.getElementById("lightboxVideo");e&&(e.controls=!0,e.style.pointerEvents="")}function z(e){const t=document.getElementById("videoLightbox"),n=document.getElementById("lightboxVideo");if(!t||!n)return;s=e,a=!0,g(),t.classList.add("active"),W();const o=P(s);if(!o)return;const y=document.querySelector('.carousel-slide[data-index="'+s+'"]')?.getAttribute("data-poster");y&&(n.poster=y);const O=document.getElementById("lightboxName"),N=document.getElementById("lightboxRole");O&&(O.textContent=o.name),N&&(N.textContent=o.role),T?(n.setAttribute("data-pending-src",o.video),p()):(n.src=o.video,n.load(),n.play().then(function(){g()}).catch(function(){p()}))}document.getElementById("lightboxVideo")?.addEventListener("playing",function(){g()}),h?.addEventListener("click",function(e){e.stopPropagation();const t=document.getElementById("lightboxVideo");if(!t)return;t.controls=!0,t.style.pointerEvents="",h?.classList.remove("visible");const n=t.getAttribute("data-pending-src");n&&(t.src=n,t.removeAttribute("data-pending-src")),t.load();const o=t.play();o!==void 0&&o.catch(function(){function i(){t.removeEventListener("canplay",i),t.removeEventListener("loadeddata",i),t.play().catch(function(){})}t.readyState>=3?t.play().catch(function(){}):(t.addEventListener("canplay",i),t.addEventListener("loadeddata",i))})});function G(){const e=document.getElementById("lightboxVideo"),t=document.getElementById("lightboxName"),n=document.getElementById("lightboxRole"),o=P(s);if(!o||!e)return;e.pause(),g();const y=document.querySelector('.carousel-slide[data-index="'+s+'"]')?.getAttribute("data-poster");y&&(e.poster=y),t&&(t.textContent=o.name),n&&(n.textContent=o.role),T?(e.setAttribute("data-pending-src",o.video),p()):(e.src=o.video,e.load(),e.play().then(function(){g()}).catch(function(){p()}))}function m(e){a&&(s=(s+e+r)%r,G())}function S(){const e=document.getElementById("videoLightbox"),t=document.getElementById("lightboxVideo");!e||!t||(t.pause(),t.removeAttribute("src"),t.removeAttribute("data-pending-src"),g(),e.classList.remove("active"),j(),a=!1)}u.forEach(e=>{e.addEventListener("click",()=>$(e))}),document.querySelector(".nav-right")?.addEventListener("click",()=>l(-1)),document.querySelector(".nav-left")?.addEventListener("click",()=>l(1));const c=document.getElementById("videoLightbox");c?.addEventListener("click",e=>{e.target===c&&S()}),c?.querySelector(".lightbox-close-btn")?.addEventListener("click",S),c?.querySelector(".lightbox-content")?.addEventListener("click",e=>e.stopPropagation()),c?.querySelector(".lightbox-nav-right")?.addEventListener("click",e=>{e.stopPropagation(),m(-1)}),c?.querySelector(".lightbox-nav-left")?.addEventListener("click",e=>{e.stopPropagation(),m(1)});let V=0,C=0;c?.addEventListener("touchstart",e=>{V=e.changedTouches[0].screenX,C=e.changedTouches[0].screenY},{passive:!0}),c?.addEventListener("touchend",e=>{const t=e.changedTouches[0].screenX,n=e.changedTouches[0].screenY,o=V-t,i=Math.abs(C-n);Math.abs(o)>50&&o>i&&a&&m(o>0?1:-1)},{passive:!0});const X=document.getElementById("carouselTrack");X?.addEventListener("touchstart",e=>{I=e.changedTouches[0].screenX},{passive:!0}),X?.addEventListener("touchend",e=>{const t=e.changedTouches[0].screenX,n=I-t;Math.abs(n)>50&&l(n>0?1:-1)},{passive:!0}),document.addEventListener("keydown",e=>{e.key==="Escape"&&a&&S(),e.key==="ArrowRight"&&(a?m(-1):l(-1)),e.key==="ArrowLeft"&&(a?m(1):l(1))}),x()})();
