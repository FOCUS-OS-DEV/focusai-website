(function(){let r=0,u=0;const d=document.querySelectorAll(".carousel-slide"),i=d.length;let s=!1,p=0,g=!1,a=!1;const y={},x={},h=document.querySelector(".video-carousel-section");if(!h)return;const E=new IntersectionObserver(e=>{e.forEach(t=>{t.isIntersecting&&!g&&(g=!0,k(),setTimeout(()=>L(),800),E.unobserve(h))})},{rootMargin:"200px 0px"});E.observe(h);function k(){d.forEach(e=>{const t=e.getAttribute("data-pos");(t==="center"||t==="left"||t==="right")&&m(e)}),setTimeout(()=>{d.forEach(e=>m(e))},1500)}function m(e){const t=e.getAttribute("data-index");if(!t||y[t])return;const n=e.getAttribute("data-poster");if(!n)return;const o=e.querySelector(".poster-img");o&&(o.onload=()=>{o.classList.add("loaded"),e.classList.add("media-ready")},o.onerror=()=>{e.classList.add("media-ready")},o.src=n,y[t]=!0)}function L(){B(r,1).forEach(t=>w(t))}const T=window.innerWidth<768;function S(e){return T?e.replace("/upload/q_auto/","/upload/w_720,q_auto/"):e}function w(e){if(x[e])return;const t=document.querySelector(`.carousel-slide[data-index="${e}"]`);if(!t)return;const n=t.getAttribute("data-video");if(!n)return;const o=t.querySelector("video");!o||o.src&&o.src!==""||(o.src=S(n)+"#t=0.1",o.preload="metadata",o.onloadeddata=()=>{o.classList.add("video-loaded")},x[e]=!0)}function B(e,t){const n=[e];for(let o=1;o<=t;o++)n.push((e+o)%i),n.push((e-o+i)%i);return n}const I=document.getElementById("carouselDots");if(I)for(let e=0;e<i;e++){const t=document.createElement("button");t.className="carousel-dot"+(e===0?" active":""),t.setAttribute("data-dot",String(e)),t.setAttribute("aria-label","עבור לעדות "+(e+1)),t.onclick=()=>C(e),I.appendChild(t)}function V(e){return e===0?"center":e===1?"left":e===-1?"right":e===2?"far-left":e===-2?"far-right":"hidden"}function b(){d.forEach(t=>{let o=parseInt(t.getAttribute("data-index")||"0")-r;o>i/2&&(o-=i),o<-i/2&&(o+=i),t.setAttribute("data-pos",V(o))}),document.querySelectorAll(".carousel-dot").forEach((t,n)=>{t.classList.toggle("active",n===r)}),g&&(d.forEach(t=>{const n=t.getAttribute("data-pos");(n==="center"||n==="left"||n==="right")&&m(t)}),setTimeout(()=>L(),300))}function C(e){s||e===r||(s=!0,r=e,b(),setTimeout(()=>{s=!1},550))}function c(e){s||(s=!0,r=(r+e+i)%i,b(),setTimeout(()=>{s=!1},550))}function N(e){const t=e.getAttribute("data-pos");if(t==="center"){const n=parseInt(e.getAttribute("data-index")||"0");X(n)}else t==="right"?c(-1):t==="left"&&c(1)}function P(e){const t=document.querySelector(`.carousel-slide[data-index="${e}"]`);return t?{video:t.getAttribute("data-video")||"",name:t.querySelector(".name")?.textContent||"",role:t.querySelector(".role")?.textContent||""}:null}function X(e){const t=document.getElementById("videoLightbox"),n=document.getElementById("lightboxVideo");!t||!n||(u=e,a=!0,A(),t.classList.add("active"),document.body.style.overflow="hidden",setTimeout(()=>n.play(),150))}function A(){const e=document.getElementById("lightboxVideo"),t=document.getElementById("lightboxName"),n=document.getElementById("lightboxRole"),o=P(u);!o||!e||(e.pause(),e.src=S(o.video),t&&(t.textContent=o.name),n&&(n.textContent=o.role),setTimeout(()=>e.play(),100))}function f(e){a&&(u=(u+e+i)%i,A())}function v(){const e=document.getElementById("videoLightbox"),t=document.getElementById("lightboxVideo");!e||!t||(t.pause(),t.src="",e.classList.remove("active"),document.body.style.overflow="",a=!1)}d.forEach(e=>{e.addEventListener("click",()=>N(e))}),document.querySelector(".nav-right")?.addEventListener("click",()=>c(-1)),document.querySelector(".nav-left")?.addEventListener("click",()=>c(1));const l=document.getElementById("videoLightbox");l?.addEventListener("click",e=>{e.target===l&&v()}),l?.querySelector(".lightbox-close-btn")?.addEventListener("click",v),l?.querySelector(".lightbox-content")?.addEventListener("click",e=>e.stopPropagation()),l?.querySelector(".lightbox-nav-right")?.addEventListener("click",e=>{e.stopPropagation(),f(-1)}),l?.querySelector(".lightbox-nav-left")?.addEventListener("click",e=>{e.stopPropagation(),f(1)});const q=document.getElementById("carouselTrack");q?.addEventListener("touchstart",e=>{p=e.changedTouches[0].screenX},{passive:!0}),q?.addEventListener("touchend",e=>{const t=e.changedTouches[0].screenX,n=p-t;Math.abs(n)>50&&c(n>0?1:-1)},{passive:!0}),document.addEventListener("keydown",e=>{e.key==="Escape"&&a&&v(),e.key==="ArrowRight"&&(a?f(-1):c(-1)),e.key==="ArrowLeft"&&(a?f(1):c(1))}),b()})();
