(function(){let c=0,u=0;const d=document.querySelectorAll(".carousel-slide"),r=d.length;let l=!1,p=0,g=!1,s=!1;const y={},E={},h=document.querySelector(".video-carousel-section");if(!h)return;const x=new IntersectionObserver(e=>{e.forEach(t=>{t.isIntersecting&&!g&&(g=!0,B(),setTimeout(()=>L(),800),x.unobserve(h))})},{rootMargin:"200px 0px"});x.observe(h);function B(){d.forEach(e=>{const t=e.getAttribute("data-pos");(t==="center"||t==="left"||t==="right")&&b(e)}),setTimeout(()=>{d.forEach(e=>b(e))},1500)}function b(e){const t=e.getAttribute("data-index");if(!t||y[t])return;const o=e.getAttribute("data-poster");if(!o)return;const n=e.querySelector(".poster-img");n&&(n.onload=()=>{n.classList.add("loaded"),e.classList.add("media-ready")},n.onerror=()=>{e.classList.add("media-ready")},n.src=o,y[t]=!0)}function L(){C(c,1).forEach(t=>V(t))}const S=window.innerWidth<768;function A(e){return S?e.replace("/upload/q_auto/","/upload/w_720,q_auto/"):e}function V(e){if(E[e])return;const t=document.querySelector(`.carousel-slide[data-index="${e}"]`);if(!t)return;const o=t.getAttribute("data-video");if(!o)return;const n=t.querySelector("video");!n||n.src&&n.src!==""||(n.src=A(o)+"#t=0.1",n.preload="metadata",n.onloadeddata=()=>{n.classList.add("video-loaded")},E[e]=!0)}function C(e,t){const o=[e];for(let n=1;n<=t;n++)o.push((e+n)%r),o.push((e-n+r)%r);return o}const I=document.getElementById("carouselDots");if(I)for(let e=0;e<r;e++){const t=document.createElement("button");t.className="carousel-dot"+(e===0?" active":""),t.setAttribute("data-dot",String(e)),t.setAttribute("aria-label","עבור לעדות "+(e+1)),t.onclick=()=>N(e),I.appendChild(t)}function X(e){return e===0?"center":e===1?"left":e===-1?"right":e===2?"far-left":e===-2?"far-right":"hidden"}function m(){d.forEach(t=>{let n=parseInt(t.getAttribute("data-index")||"0")-c;n>r/2&&(n-=r),n<-r/2&&(n+=r),t.setAttribute("data-pos",X(n))}),document.querySelectorAll(".carousel-dot").forEach((t,o)=>{t.classList.toggle("active",o===c)}),g&&(d.forEach(t=>{const o=t.getAttribute("data-pos");(o==="center"||o==="left"||o==="right")&&b(t)}),setTimeout(()=>L(),300))}function N(e){l||e===c||(l=!0,c=e,m(),setTimeout(()=>{l=!1},550))}function a(e){l||(l=!0,c=(c+e+r)%r,m(),setTimeout(()=>{l=!1},550))}function P(e){const t=e.getAttribute("data-pos");if(t==="center"){const o=parseInt(e.getAttribute("data-index")||"0");U(o)}else t==="right"?a(-1):t==="left"&&a(1)}function M(e){const t=document.querySelector(`.carousel-slide[data-index="${e}"]`);return t?{video:t.getAttribute("data-video")||"",name:t.querySelector(".name")?.textContent||"",role:t.querySelector(".role")?.textContent||""}:null}function U(e){const t=document.getElementById("videoLightbox"),o=document.getElementById("lightboxVideo");!t||!o||(u=e,s=!0,t.classList.add("active"),document.body.style.overflow="hidden",q())}function q(){const e=document.getElementById("lightboxVideo"),t=document.getElementById("lightboxName"),o=document.getElementById("lightboxRole"),n=M(u);if(!n||!e)return;e.pause(),e.oncanplay=null,e.removeAttribute("src"),e.load();const w=document.querySelector('.carousel-slide[data-index="'+u+'"]')?.getAttribute("data-poster");w&&(e.poster=w),t&&(t.textContent=n.name),o&&(o.textContent=n.role),e.src=A(n.video),e.load(),S||(e.oncanplay=()=>{e.oncanplay=null,e.play().catch(()=>{})})}function f(e){s&&(u=(u+e+r)%r,q())}function v(){const e=document.getElementById("videoLightbox"),t=document.getElementById("lightboxVideo");!e||!t||(t.pause(),t.src="",e.classList.remove("active"),document.body.style.overflow="",s=!1)}d.forEach(e=>{e.addEventListener("click",()=>P(e))}),document.querySelector(".nav-right")?.addEventListener("click",()=>a(-1)),document.querySelector(".nav-left")?.addEventListener("click",()=>a(1));const i=document.getElementById("videoLightbox");i?.addEventListener("click",e=>{e.target===i&&v()}),i?.querySelector(".lightbox-close-btn")?.addEventListener("click",v),i?.querySelector(".lightbox-content")?.addEventListener("click",e=>e.stopPropagation()),i?.querySelector(".lightbox-nav-right")?.addEventListener("click",e=>{e.stopPropagation(),f(-1)}),i?.querySelector(".lightbox-nav-left")?.addEventListener("click",e=>{e.stopPropagation(),f(1)});let k=0;i?.addEventListener("touchstart",e=>{k=e.changedTouches[0].screenX},{passive:!0}),i?.addEventListener("touchend",e=>{const t=e.changedTouches[0].screenX,o=k-t;Math.abs(o)>50&&s&&f(o>0?1:-1)},{passive:!0});const T=document.getElementById("carouselTrack");T?.addEventListener("touchstart",e=>{p=e.changedTouches[0].screenX},{passive:!0}),T?.addEventListener("touchend",e=>{const t=e.changedTouches[0].screenX,o=p-t;Math.abs(o)>50&&a(o>0?1:-1)},{passive:!0}),document.addEventListener("keydown",e=>{e.key==="Escape"&&s&&v(),e.key==="ArrowRight"&&(s?f(-1):a(-1)),e.key==="ArrowLeft"&&(s?f(1):a(1))}),m()})();
