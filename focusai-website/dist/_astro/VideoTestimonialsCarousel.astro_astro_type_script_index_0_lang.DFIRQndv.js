(function(){let c=0,s=0;const l=document.querySelectorAll(".carousel-slide"),i=l.length;let u=!1,x=0,m=!1,d=!1;const L={},S={},y=document.querySelector(".video-carousel-section");if(!y)return;const I=new IntersectionObserver(e=>{e.forEach(t=>{t.isIntersecting&&!m&&(m=!0,X(),setTimeout(()=>q(),800),I.unobserve(y))})},{rootMargin:"200px 0px"});I.observe(y);function X(){l.forEach(e=>{const t=e.getAttribute("data-pos");(t==="center"||t==="left"||t==="right")&&b(e)}),setTimeout(()=>{l.forEach(e=>b(e))},1500)}function b(e){const t=e.getAttribute("data-index");if(!t||L[t])return;const o=e.getAttribute("data-poster");if(!o)return;const n=e.querySelector(".poster-img");n&&(n.onload=()=>{n.classList.add("loaded"),e.classList.add("media-ready")},n.onerror=()=>{e.classList.add("media-ready")},n.src=o,L[t]=!0)}function q(){U(c,1).forEach(t=>M(t))}const N=window.innerWidth<768;function P(e){return N?e.replace("/upload/q_auto/","/upload/w_720,q_auto/"):e}function M(e){if(S[e])return;const t=document.querySelector(`.carousel-slide[data-index="${e}"]`);if(!t)return;const o=t.getAttribute("data-video");if(!o)return;const n=t.querySelector("video");!n||n.src&&n.src!==""||(n.src=P(o)+"#t=0.1",n.preload="metadata",n.onloadeddata=()=>{n.classList.add("video-loaded")},S[e]=!0)}function U(e,t){const o=[e];for(let n=1;n<=t;n++)o.push((e+n)%i),o.push((e-n+i)%i);return o}const A=document.getElementById("carouselDots");if(A)for(let e=0;e<i;e++){const t=document.createElement("button");t.className="carousel-dot"+(e===0?" active":""),t.setAttribute("data-dot",String(e)),t.setAttribute("aria-label","עבור לעדות "+(e+1)),t.onclick=()=>O(e),A.appendChild(t)}function Y(e){return e===0?"center":e===1?"left":e===-1?"right":e===2?"far-left":e===-2?"far-right":"hidden"}function p(){l.forEach(t=>{let n=parseInt(t.getAttribute("data-index")||"0")-c;n>i/2&&(n-=i),n<-i/2&&(n+=i),t.setAttribute("data-pos",Y(n))}),document.querySelectorAll(".carousel-dot").forEach((t,o)=>{t.classList.toggle("active",o===c)}),m&&(l.forEach(t=>{const o=t.getAttribute("data-pos");(o==="center"||o==="left"||o==="right")&&b(t)}),setTimeout(()=>q(),300))}function O(e){u||e===c||(u=!0,c=e,p(),setTimeout(()=>{u=!1},550))}function a(e){u||(u=!0,c=(c+e+i)%i,p(),setTimeout(()=>{u=!1},550))}function R(e){const t=e.getAttribute("data-pos");if(t==="center"){const o=parseInt(e.getAttribute("data-index")||"0");F(o)}else t==="right"?a(-1):t==="left"&&a(1)}function k(e){const t=document.querySelector(`.carousel-slide[data-index="${e}"]`);return t?{video:t.getAttribute("data-video")||"",name:t.querySelector(".name")?.textContent||"",role:t.querySelector(".role")?.textContent||""}:null}function _(){document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",window.lenis?.stop();const e=document.querySelector("header");e&&(e.style.display="none");const t=document.getElementById("whatsapp-float");t&&(t.style.display="none");const o=document.getElementById("back-to-top");o&&(o.style.display="none")}function D(){document.body.style.overflow="",document.documentElement.style.overflow="",window.lenis?.start();const e=document.querySelector("header");e&&(e.style.display="");const t=document.getElementById("whatsapp-float");t&&(t.style.display="");const o=document.getElementById("back-to-top");o&&(o.style.display="")}function F(e){const t=document.getElementById("videoLightbox"),o=document.getElementById("lightboxVideo");if(!t||!o)return;s=e,d=!0,t.classList.add("active"),_();const n=k(s);if(!n)return;const g=document.querySelector('.carousel-slide[data-index="'+s+'"]')?.getAttribute("data-poster");g&&(o.poster=g);const C=document.getElementById("lightboxName"),V=document.getElementById("lightboxRole");C&&(C.textContent=n.name),V&&(V.textContent=n.role),o.src=n.video,o.play().catch(function(){o.addEventListener("canplay",function W(){o.removeEventListener("canplay",W)},{once:!0})})}function $(){const e=document.getElementById("lightboxVideo"),t=document.getElementById("lightboxName"),o=document.getElementById("lightboxRole"),n=k(s);if(!n||!e)return;e.pause();const g=document.querySelector('.carousel-slide[data-index="'+s+'"]')?.getAttribute("data-poster");g&&(e.poster=g),t&&(t.textContent=n.name),o&&(o.textContent=n.role),e.src=n.video,e.play().catch(function(){})}function f(e){d&&(s=(s+e+i)%i,$())}function v(){const e=document.getElementById("videoLightbox"),t=document.getElementById("lightboxVideo");!e||!t||(t.pause(),t.removeAttribute("src"),e.classList.remove("active"),D(),d=!1)}l.forEach(e=>{e.addEventListener("click",()=>R(e))}),document.querySelector(".nav-right")?.addEventListener("click",()=>a(-1)),document.querySelector(".nav-left")?.addEventListener("click",()=>a(1));const r=document.getElementById("videoLightbox");r?.addEventListener("click",e=>{e.target===r&&v()}),r?.querySelector(".lightbox-close-btn")?.addEventListener("click",v),r?.querySelector(".lightbox-content")?.addEventListener("click",e=>e.stopPropagation()),r?.querySelector(".lightbox-nav-right")?.addEventListener("click",e=>{e.stopPropagation(),f(-1)}),r?.querySelector(".lightbox-nav-left")?.addEventListener("click",e=>{e.stopPropagation(),f(1)});let w=0,B=0;const h=r?.querySelector(".lightbox-content");r?.addEventListener("touchstart",e=>{h&&h.contains(e.target)||(w=e.changedTouches[0].screenX,B=e.changedTouches[0].screenY)},{passive:!0}),r?.addEventListener("touchend",e=>{if(h&&h.contains(e.target))return;const t=e.changedTouches[0].screenX,o=e.changedTouches[0].screenY,n=w-t,E=Math.abs(B-o);Math.abs(n)>50&&n>E&&d&&f(n>0?1:-1)},{passive:!0});const T=document.getElementById("carouselTrack");T?.addEventListener("touchstart",e=>{x=e.changedTouches[0].screenX},{passive:!0}),T?.addEventListener("touchend",e=>{const t=e.changedTouches[0].screenX,o=x-t;Math.abs(o)>50&&a(o>0?1:-1)},{passive:!0}),document.addEventListener("keydown",e=>{e.key==="Escape"&&d&&v(),e.key==="ArrowRight"&&(d?f(-1):a(-1)),e.key==="ArrowLeft"&&(d?f(1):a(1))}),p()})();
