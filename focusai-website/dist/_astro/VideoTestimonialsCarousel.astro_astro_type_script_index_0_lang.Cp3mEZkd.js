(function(){let r=0,s=0;const u=document.querySelectorAll(".carousel-slide"),i=u.length;let f=!1,L=0,m=!1,d=!1;const S={},I={},y=document.querySelector(".video-carousel-section");if(!y)return;const k=new IntersectionObserver(e=>{e.forEach(t=>{t.isIntersecting&&!m&&(m=!0,N(),setTimeout(()=>q(),800),k.unobserve(y))})},{rootMargin:"200px 0px"});k.observe(y);function N(){u.forEach(e=>{const t=e.getAttribute("data-pos");(t==="center"||t==="left"||t==="right")&&b(e)}),setTimeout(()=>{u.forEach(e=>b(e))},1500)}function b(e){const t=e.getAttribute("data-index");if(!t||S[t])return;const n=e.getAttribute("data-poster");if(!n)return;const o=e.querySelector(".poster-img");o&&(o.onload=()=>{o.classList.add("loaded"),e.classList.add("media-ready")},o.onerror=()=>{e.classList.add("media-ready")},o.src=n,S[t]=!0)}function q(){Y(r,1).forEach(t=>U(t))}const O=window.innerWidth<768;function M(e){return O?e.replace("/upload/q_auto/","/upload/w_720,q_auto/"):e}function U(e){if(I[e])return;const t=document.querySelector(`.carousel-slide[data-index="${e}"]`);if(!t)return;const n=t.getAttribute("data-video");if(!n)return;const o=t.querySelector("video");!o||o.src&&o.src!==""||(o.src=M(n)+"#t=0.1",o.preload="metadata",o.onloadeddata=()=>{o.classList.add("video-loaded")},I[e]=!0)}function Y(e,t){const n=[e];for(let o=1;o<=t;o++)n.push((e+o)%i),n.push((e-o+i)%i);return n}const w=document.getElementById("carouselDots");if(w)for(let e=0;e<i;e++){const t=document.createElement("button");t.className="carousel-dot"+(e===0?" active":""),t.setAttribute("data-dot",String(e)),t.setAttribute("aria-label","עבור לעדות "+(e+1)),t.onclick=()=>_(e),w.appendChild(t)}function R(e){return e===0?"center":e===1?"left":e===-1?"right":e===2?"far-left":e===-2?"far-right":"hidden"}function p(){u.forEach(t=>{let o=parseInt(t.getAttribute("data-index")||"0")-r;o>i/2&&(o-=i),o<-i/2&&(o+=i),t.setAttribute("data-pos",R(o))}),document.querySelectorAll(".carousel-dot").forEach((t,n)=>{t.classList.toggle("active",n===r)}),m&&(u.forEach(t=>{const n=t.getAttribute("data-pos");(n==="center"||n==="left"||n==="right")&&b(t)}),setTimeout(()=>q(),300))}function _(e){f||e===r||(f=!0,r=e,p(),setTimeout(()=>{f=!1},550))}function a(e){f||(f=!0,r=(r+e+i)%i,p(),setTimeout(()=>{f=!1},550))}function D(e){const t=e.getAttribute("data-pos");if(t==="center"){const n=parseInt(e.getAttribute("data-index")||"0");W(n)}else t==="right"?a(-1):t==="left"&&a(1)}function A(e){const t=document.querySelector(`.carousel-slide[data-index="${e}"]`);return t?{video:t.getAttribute("data-video")||"",name:t.querySelector(".name")?.textContent||"",role:t.querySelector(".role")?.textContent||""}:null}function F(){document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",window.lenis?.stop();const e=document.querySelector("header");e&&(e.style.display="none");const t=document.getElementById("whatsapp-float");t&&(t.style.display="none");const n=document.getElementById("back-to-top");n&&(n.style.display="none")}function $(){document.body.style.overflow="",document.documentElement.style.overflow="",window.lenis?.start();const e=document.querySelector("header");e&&(e.style.display="");const t=document.getElementById("whatsapp-float");t&&(t.style.display="");const n=document.getElementById("back-to-top");n&&(n.style.display="")}const v=document.getElementById("lightboxPlayOverlay");function B(){v?.classList.add("visible")}function l(){v?.classList.remove("visible")}function W(e){const t=document.getElementById("videoLightbox"),n=document.getElementById("lightboxVideo");if(!t||!n)return;s=e,d=!0,l(),t.classList.add("active"),F();const o=A(s);if(!o)return;const g=document.querySelector('.carousel-slide[data-index="'+s+'"]')?.getAttribute("data-poster");g&&(n.poster=g);const P=document.getElementById("lightboxName"),X=document.getElementById("lightboxRole");P&&(P.textContent=o.name),X&&(X.textContent=o.role),n.src=o.video,n.play().then(function(){l()}).catch(function(){B()})}v?.addEventListener("click",function(e){e.stopPropagation();const t=document.getElementById("lightboxVideo");t&&t.play().then(function(){l()}).catch(function(){t.load(),t.play().catch(function(){}),l()})});function j(){const e=document.getElementById("lightboxVideo"),t=document.getElementById("lightboxName"),n=document.getElementById("lightboxRole"),o=A(s);if(!o||!e)return;e.pause(),l();const g=document.querySelector('.carousel-slide[data-index="'+s+'"]')?.getAttribute("data-poster");g&&(e.poster=g),t&&(t.textContent=o.name),n&&(n.textContent=o.role),e.src=o.video,e.play().then(function(){l()}).catch(function(){B()})}function h(e){d&&(s=(s+e+i)%i,j())}function E(){const e=document.getElementById("videoLightbox"),t=document.getElementById("lightboxVideo");!e||!t||(t.pause(),t.removeAttribute("src"),l(),e.classList.remove("active"),$(),d=!1)}u.forEach(e=>{e.addEventListener("click",()=>D(e))}),document.querySelector(".nav-right")?.addEventListener("click",()=>a(-1)),document.querySelector(".nav-left")?.addEventListener("click",()=>a(1));const c=document.getElementById("videoLightbox");c?.addEventListener("click",e=>{e.target===c&&E()}),c?.querySelector(".lightbox-close-btn")?.addEventListener("click",E),c?.querySelector(".lightbox-content")?.addEventListener("click",e=>e.stopPropagation()),c?.querySelector(".lightbox-nav-right")?.addEventListener("click",e=>{e.stopPropagation(),h(-1)}),c?.querySelector(".lightbox-nav-left")?.addEventListener("click",e=>{e.stopPropagation(),h(1)});let T=0,V=0;c?.addEventListener("touchstart",e=>{T=e.changedTouches[0].screenX,V=e.changedTouches[0].screenY},{passive:!0}),c?.addEventListener("touchend",e=>{const t=e.changedTouches[0].screenX,n=e.changedTouches[0].screenY,o=T-t,x=Math.abs(V-n);Math.abs(o)>50&&o>x&&d&&h(o>0?1:-1)},{passive:!0});const C=document.getElementById("carouselTrack");C?.addEventListener("touchstart",e=>{L=e.changedTouches[0].screenX},{passive:!0}),C?.addEventListener("touchend",e=>{const t=e.changedTouches[0].screenX,n=L-t;Math.abs(n)>50&&a(n>0?1:-1)},{passive:!0}),document.addEventListener("keydown",e=>{e.key==="Escape"&&d&&E(),e.key==="ArrowRight"&&(d?h(-1):a(-1)),e.key==="ArrowLeft"&&(d?h(1):a(1))}),p()})();
