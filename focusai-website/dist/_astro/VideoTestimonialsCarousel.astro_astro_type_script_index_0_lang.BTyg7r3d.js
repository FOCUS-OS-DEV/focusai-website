(function(){let s=0,a=0;const f=document.querySelectorAll(".carousel-slide"),r=f.length;let g=!1,E=0,m=!1,d=!1;const x={},S={},b=document.querySelector(".video-carousel-section");if(!b)return;const L=new IntersectionObserver(e=>{e.forEach(t=>{t.isIntersecting&&!m&&(m=!0,P(),setTimeout(()=>A(),800),L.unobserve(b))})},{rootMargin:"200px 0px"});L.observe(b);function P(){f.forEach(e=>{const t=e.getAttribute("data-pos");(t==="center"||t==="left"||t==="right")&&v(e)}),setTimeout(()=>{f.forEach(e=>v(e))},1500)}function v(e){const t=e.getAttribute("data-index");if(!t||x[t])return;const n=e.getAttribute("data-poster");if(!n)return;const o=e.querySelector(".poster-img");o&&(o.onload=()=>{o.classList.add("loaded"),e.classList.add("media-ready")},o.onerror=()=>{e.classList.add("media-ready")},o.src=n,x[t]=!0)}function A(){Y(s,1).forEach(t=>M(t))}const X=window.innerWidth<768;function N(e){return X?e.replace("/upload/q_auto/","/upload/w_720,q_auto/"):e}function M(e){if(S[e])return;const t=document.querySelector(`.carousel-slide[data-index="${e}"]`);if(!t)return;const n=t.getAttribute("data-video");if(!n)return;const o=t.querySelector("video");!o||o.src&&o.src!==""||(o.src=N(n)+"#t=0.1",o.preload="metadata",o.onloadeddata=()=>{o.classList.add("video-loaded")},S[e]=!0)}function Y(e,t){const n=[e];for(let o=1;o<=t;o++)n.push((e+o)%r),n.push((e-o+r)%r);return n}const I=document.getElementById("carouselDots");if(I)for(let e=0;e<r;e++){const t=document.createElement("button");t.className="carousel-dot"+(e===0?" active":""),t.setAttribute("data-dot",String(e)),t.setAttribute("aria-label","עבור לעדות "+(e+1)),t.onclick=()=>U(e),I.appendChild(t)}function O(e){return e===0?"center":e===1?"left":e===-1?"right":e===2?"far-left":e===-2?"far-right":"hidden"}function p(){f.forEach(t=>{let o=parseInt(t.getAttribute("data-index")||"0")-s;o>r/2&&(o-=r),o<-r/2&&(o+=r),t.setAttribute("data-pos",O(o))}),document.querySelectorAll(".carousel-dot").forEach((t,n)=>{t.classList.toggle("active",n===s)}),m&&(f.forEach(t=>{const n=t.getAttribute("data-pos");(n==="center"||n==="left"||n==="right")&&v(t)}),setTimeout(()=>A(),300))}function U(e){g||e===s||(g=!0,s=e,p(),setTimeout(()=>{g=!1},550))}function l(e){g||(g=!0,s=(s+e+r)%r,p(),setTimeout(()=>{g=!1},550))}function R(e){const t=e.getAttribute("data-pos");if(t==="center"){const n=parseInt(e.getAttribute("data-index")||"0");$(n)}else t==="right"?l(-1):t==="left"&&l(1)}function k(e){const t=document.querySelector(`.carousel-slide[data-index="${e}"]`);return t?{video:t.getAttribute("data-video")||"",name:t.querySelector(".name")?.textContent||"",role:t.querySelector(".role")?.textContent||""}:null}const _=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1;function D(){document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",window.lenis?.stop()}function F(){document.body.style.overflow="",document.documentElement.style.overflow="",window.lenis?.start()}function q(e,t,n){const o=e.querySelector("video");o&&(o.pause(),o.removeAttribute("src"),o.remove());const i=document.createElement("video");i.controls=!0,i.playsInline=!0,i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline",""),i.preload="auto",t&&(i.poster=t);const u=document.createElement("track");return u.kind="captions",u.default=!0,i.appendChild(u),e.appendChild(i),requestAnimationFrame(function(){i.src=n,_||i.play().catch(function(){})}),i}function $(e){const t=document.getElementById("videoLightbox"),n=document.getElementById("lightboxVideoContainer");if(!t||!n)return;a=e,d=!0,t.classList.add("active"),D();const o=k(a);if(!o)return;const u=document.querySelector('.carousel-slide[data-index="'+a+'"]')?.getAttribute("data-poster")||"",B=document.getElementById("lightboxName"),V=document.getElementById("lightboxRole");B&&(B.textContent=o.name),V&&(V.textContent=o.role),q(n,u,o.video)}function W(){const e=document.getElementById("lightboxVideoContainer"),t=document.getElementById("lightboxName"),n=document.getElementById("lightboxRole"),o=k(a);if(!o||!e)return;const u=document.querySelector('.carousel-slide[data-index="'+a+'"]')?.getAttribute("data-poster")||"";t&&(t.textContent=o.name),n&&(n.textContent=o.role),q(e,u,o.video)}function h(e){d&&(a=(a+e+r)%r,W())}function y(){const e=document.getElementById("videoLightbox"),t=document.getElementById("lightboxVideoContainer");if(!e)return;const n=t?.querySelector("video");n&&(n.pause(),n.removeAttribute("src"),n.remove()),e.classList.remove("active"),F(),d=!1}f.forEach(e=>{e.addEventListener("click",()=>R(e))}),document.querySelector(".nav-right")?.addEventListener("click",()=>l(-1)),document.querySelector(".nav-left")?.addEventListener("click",()=>l(1));const c=document.getElementById("videoLightbox");c?.addEventListener("click",e=>{e.target===c&&y()}),c?.querySelector(".lightbox-close-btn")?.addEventListener("click",y),c?.querySelector(".lightbox-content")?.addEventListener("click",e=>e.stopPropagation()),c?.querySelector(".lightbox-nav-right")?.addEventListener("click",e=>{e.stopPropagation(),h(-1)}),c?.querySelector(".lightbox-nav-left")?.addEventListener("click",e=>{e.stopPropagation(),h(1)});let w=0,T=0;c?.addEventListener("touchstart",e=>{w=e.changedTouches[0].screenX,T=e.changedTouches[0].screenY},{passive:!0}),c?.addEventListener("touchend",e=>{const t=e.changedTouches[0].screenX,n=e.changedTouches[0].screenY,o=w-t,i=Math.abs(T-n);Math.abs(o)>50&&o>i&&d&&h(o>0?1:-1)},{passive:!0});const C=document.getElementById("carouselTrack");C?.addEventListener("touchstart",e=>{E=e.changedTouches[0].screenX},{passive:!0}),C?.addEventListener("touchend",e=>{const t=e.changedTouches[0].screenX,n=E-t;Math.abs(n)>50&&l(n>0?1:-1)},{passive:!0}),document.addEventListener("keydown",e=>{e.key==="Escape"&&d&&y(),e.key==="ArrowRight"&&(d?h(-1):l(-1)),e.key==="ArrowLeft"&&(d?h(1):l(1))}),p()})();
